import { KeyValue } from '@angular/common';
import {
  Component,
  Input,
  OnInit,
  SimpleChanges,
  OnChanges,
  Output,
  EventEmitter,
} from '@angular/core';
import { IMetricData } from '@core/services/metrics/monitoring.service';
import { ModelVersion } from '@shared/models/_index';
import { isEmptyObj } from '@shared/utils/is-empty-object';
import * as _ from 'lodash';
import { ExplanationRequestBody } from '@rootcause/interfaces';

@Component({
  selector: 'hs-reqstore-table-log',
  templateUrl: './reqstore-table-log.component.html',
  styleUrls: ['./reqstore-table-log.component.scss'],
})
export class ReqstoreTableLogComponent implements OnInit, OnChanges {
  @Input()
  modelVersion: ModelVersion;

  @Input()
  logData: any;

  @Input()
  loading: any = false;

  @Output()
  clickedGetExplanation: EventEmitter<ExplanationRequestBody> = new EventEmitter();

  uid: string;
  ngOnChanges(changes: SimpleChanges): void {
    if (changes.logData && changes.logData.currentValue) {
      const sameData = _.isEqual(
        changes.logData.previousValue,
        changes.logData.currentValue
      );
      const values = Object.keys(changes.logData.currentValue);
      if (values.length > 0) {
        if (!sameData) {
          this.uid = values[0];
        }
      } else {
        this.uid = undefined;
      }
    }
  }

  ngOnInit(): void {}

  get selectedLogItem() {
    return this.logData[this.uid];
  }

  selectLogItem(uid: string) {
    this.uid = uid;
  }

  logNotEmpty(): boolean {
    return !isEmptyObj(this.logData);
  }

  getExplanation(): void {
    // ? how to get instance, contracts?????


    const explainedInstance = [[1.3534601229955594,
   -1.59306913276829,
   0.4858361392101022,
   0.7814870269743248,
   0.36068787927137086,
   1.3859300895012523,
   1.0653100617054125,
   1.026952000409761,
   -0.8508592385550836,
   -1.5203091109285285,
   2.5103052565450614,
   -0.01569106083383286,
   -1.3939541466691197,
   1.01047167877397,
   0.11775899185630063,
   -0.2931528001839794,
   2.0154205952951454,
   0.2158784662401798,
   0.6338723602014612,
   0.33845418295577623,
   -0.3892694039126986,
   -0.43005739996184716,
   -0.5537555274656645,
   0.8863769082037193,
   0.5758185480501042,
   -0.37370731820912917,
   0.4649399229980337,
   -0.3645800773394631],
  [-0.5736830411040497,
   -0.546509116763283,
   1.6285275827034296,
   0.3961609847424107,
   -0.2838711379006387,
   0.1619348782704218,
   -0.4807395701983978,
   -0.3759893604765563,
   1.3313401140694838,
   -0.8578371804199922,
   0.16723020748609735,
   -2.1029160426442823,
   -1.2189116376578553,
   0.629114085927409,
   -0.16958953446001848,
   -1.071929874587661,
   -0.6509834222036699,
   0.1485292478648132,
   0.6385528972063101,
   -0.1264341342946592,
   -0.016998965413625416,
   0.9293776016869665,
   1.365553556634228,
   1.4954921086051007,
   -1.5623565665068393,
   0.17952799276078057,
   -0.42860105896670125,
   -1.2173894729487575],
  [-1.226713848836185,
   -0.7258397308128846,
   0.1782950748307933,
   -1.4872674347192265,
   0.9356979258845275,
   -0.25014903490094426,
   0.2922592210763855,
   -0.1140504943481344,
   -0.49343247606561896,
   -1.431054878167619,
   -1.831260698331085,
   -0.5913672758528685,
   1.3743245064397358,
   1.7109281045008233,
   -0.5444594066639304,
   1.0825434383666512,
   -1.004641813196975,
   0.4897511604642299,
   -0.4043029829803073,
   0.3946939869907238,
   -1.5626121544845446,
   -0.4428735704619316,
   0.8663654844584765,
   0.5256868835737634,
   0.698065958723508,
   1.5890793973533972,
   0.3820729454069341,
   2.0209277658541263],
  [0.6796959638934333,
   -0.6328198807817533,
   -1.5450565433045775,
   -0.9746155607278782,
   -0.6478090839757876,
   -0.0629284845532636,
   0.5510390764900689,
   -1.5863121918088352,
   -1.5993726384733693,
   0.2835655542530202,
   -0.08356947348289102,
   0.6000369434180138,
   0.7084585338402727,
   -0.5388012758768784,
   -0.6786878722286588,
   1.34688183408046,
   -1.4447377382728437,
   1.9220184359183077,
   0.6031969813136746,
   1.87459663488735,
   0.7195155536891343,
   -0.7194848587045667,
   1.4468105886212361,
   -0.886062351889374,
   0.0870459038461917,
   1.1550425033383784,
   0.33064497608899635,
   1.5808036939203478],
  [0.17178593770520198,
   -0.5469718314250215,
   -0.20073934561648094,
   -0.021612453404774547,
   0.4369818525205556,
   1.7244757521400407,
   0.21774378632648492,
   0.9903040796668707,
   -1.8455056834806278,
   0.5245004352349929,
   -0.5232083111723352,
   -0.5366185072589034,
   -2.4126077764779263,
   0.9181345481602783,
   0.0786902119568505,
   -0.7089946182295158,
   -0.09971532387029901,
   -0.0881983502699386,
   1.0121673457122085,
   -0.010270233077558692,
   0.5499067856808516,
   -0.9861142555763612,
   -0.3521592461406233,
   0.9849988965113667,
   1.4933397886578912,
   -0.2870856746981119,
   0.6844172067164576,
   -1.1790381502561424],
  [0.8638036361427451,
   -1.3511412225678032,
   0.2606478585114882,
   0.6580063822977456,
   -0.7834845307862884,
   1.8434819873250339,
   0.1027909109074219,
   -2.5693794366797027,
   0.4718005424814023,
   -0.23866253921549735,
   -0.3968405509278774,
   0.33374060623362134,
   -0.14773769763413777,
   -2.2514733243121365,
   -0.15338649158249115,
   3.964332429347174e-05,
   0.8812212788502797,
   -0.43145132034609884,
   -1.7735219228617365,
   -3.2565808914929772,
   -1.903762114373117,
   -0.11739779186905862,
   -0.6058051394830501,
   -0.4760878350696511,
   0.37592529853687306,
   -1.3772587519744222,
   -0.030424297031541564,
   0.5077800517773041],
  [-0.014008892864031706,
   -2.1961007445360505,
   1.1177757170473936,
   1.3036476363864355,
   0.7579191712492751,
   0.7972554947626239,
   1.3260008697882817,
   0.12881756830872018,
   -1.2803981752281377,
   -0.22927224434272392,
   0.17947930067457352,
   0.6255257341015221,
   -0.40560055622409413,
   0.2579376863418947,
   0.2920461995309342,
   1.1602254874491902,
   1.2522664218175088,
   -1.4770710894497263,
   -2.2244651170197334,
   0.725925701588996,
   -0.2477933874879705,
   0.41134779600662635,
   -0.732251786182358,
   -1.3319142155895203,
   -0.3553697588542845,
   -0.36942062849123186,
   -0.7620241130935351,
   -1.3150174543913264],
  [-1.0419736587012036,
   0.23737056228599576,
   0.6867685710968909,
   -0.32183156841864685,
   -0.14657482272688788,
   -1.2541152101637805,
   0.705307359963993,
   1.757947246332495,
   -0.09921106578450314,
   1.4388902917955737,
   -0.9097086497221979,
   -0.8450745774034117,
   -0.11336453897701489,
   -1.6647258003046659,
   -2.3238731021816266,
   1.43237301273386,
   -0.5659519999933014,
   0.8545472218184403,
   0.6131244532014298,
   -1.054386533339358,
   0.2701073369873824,
   -1.2452122676195303,
   -1.0137779071897404,
   -1.0602049249790562,
   0.2715067057883143,
   0.25686170253131624,
   -1.5954117459965547,
   -1.4157051724970127],
  [-1.4876221014457667,
   -1.7876816873813222,
   0.403624290953823,
   0.9559256894711728,
   1.3772572578010263,
   1.3818157799631816,
   1.5222417330012894,
   -0.8853388392820657,
   -0.8802983896463515,
   -0.8518944090742928,
   -0.17181838859456416,
   0.25125664188704633,
   -0.6529271261511478,
   1.0400027826700022,
   0.8306875188536949,
   0.41668446389012104,
   1.385115996229696,
   0.5962621476425827,
   -0.48805543119965705,
   0.38390910018544105,
   0.8443814082908659,
   -0.2896266935699998,
   -0.7991828783826216,
   -1.297319434095246,
   0.7270352916598382,
   0.9453702372777515,
   -1.2074907073539356,
   0.8053094496387088],
  [0.8716145475443391,
   -0.4028526237727243,
   -1.1606443255070225,
   -0.2838266992885844,
   0.8120777324495303,
   -0.5058209867114275,
   -0.7296761027634479,
   -0.17447588174260717,
   0.08595908665499635,
   0.7784700592610349,
   -0.126905717081445,
   -0.28375008137751406,
   0.024804475706548066,
   -0.5806143905576477,
   -0.6108444192109855,
   0.4835242699457043,
   -1.117625176709814,
   1.7644568656141746,
   -0.14030760657451977,
   0.5177354371025624,
   -0.28276153602212317,
   -1.9479455060845599,
   -0.12403238761068812,
   -1.0388638167636643,
   0.19919505423647932,
   -1.8155469973076481,
   1.2884305531964704,
   2.250993397068557],
  [0.05449565011978983,
   0.37019974673569694,
   -1.5214084997547124,
   -0.2605359193187025,
   0.8803558735258751,
   -0.055418396758545624,
   0.64420283216263,
   -0.7019692076140758,
   -0.09010848019867601,
   0.970128861117107,
   -0.42160679749396784,
   -1.0736258664338343,
   -1.3856802936758617,
   -2.6034747367159965,
   0.7431293125068439,
   0.737526554241007,
   0.03492185544534355,
   0.8426673769910877,
   -0.37906574660011694,
   0.6304346814521625,
   0.8440649402753811,
   0.6380634370840742,
   -0.6337204504738636,
   -0.5652207687053228,
   1.2301121969173034,
   0.3792021611721069,
   -1.1278560267736548,
   -2.620202445670524],
  [-0.11860064159614375,
   2.3866161914961586,
   0.5332286435518588,
   -0.34797388981113875,
   1.2227015017498162,
   0.6007798395056951,
   -0.7482293478139432,
   -1.4407506395144527,
   1.0990437105184339,
   -0.3565585921611208,
   0.4648193116414405,
   -0.25254448290455517,
   -1.680293813975472,
   0.7023470406718109,
   -0.07704715659066654,
   1.1295462683341044,
   -0.026493365029804507,
   -0.682018210845321,
   -0.24466760944447086,
   -1.8544883120629854,
   1.21868519058042,
   0.8560524836614638,
   0.19678552797355575,
   1.144020667954734,
   -0.5487594930594387,
   -0.22854939465006283,
   2.269052289591728,
   1.1816698127103897],
  [0.9462706634432102,
   -1.139316495218791,
   -0.4964753401325649,
   -0.4706866097449894,
   0.20770539208419556,
   3.202537411344884,
   -0.8844852939991114,
   2.487811824283466,
   -0.5249463044383056,
   1.2103974354978089,
   0.389539606663014,
   -1.8353658446503662,
   0.22946998167540342,
   0.06730855937256747,
   0.5192045337092933,
   -0.9454770566709269,
   -0.15053007321678813,
   -0.8708010568753625,
   -1.08362247183398,
   -1.4161007204914362,
   0.9099552111213082,
   0.21151353609461274,
   -0.5504671750867415,
   1.9393077076386405,
   0.38014360468973474,
   0.6790266428756293,
   1.353385912770069,
   1.3051354875328485],
  [0.7740159093905836,
   -0.7042462636358761,
   -1.3425355002812573,
   -1.284911792340242,
   1.3483527380796598,
   1.7680579534193799,
   -0.5720425392142453,
   1.243815717716144,
   -0.8026092544089407,
   -0.03912308469636183,
   -0.026324121426658718,
   -0.9703914525959132,
   -0.9175155896977805,
   0.600880962754964,
   -1.8997332901571833,
   1.2666003628695321,
   0.06889647460115128,
   0.048143487211709676,
   -1.340459357229316,
   0.5585013661365736,
   1.438921946285252,
   -0.5585866473736637,
   0.46790714226508306,
   0.2733412908952352,
   0.04613985722440785,
   0.5340564828805195,
   1.2932300184979446,
   -0.48241397310398176],
  [-0.5507044160791881,
   0.8387564684215875,
   -0.8780825714804219,
   0.6108190707787527,
   -1.9191474529231207,
   0.8787740601487268,
   0.3804296906368726,
   1.878506350443408,
   1.5351159974880038,
   0.5854661905191866,
   0.38550144115882656,
   -0.28591890401110565,
   -1.3848778008094687,
   0.36397697947267743,
   0.16522329027830554,
   -1.056910511277578,
   -0.22213677349500707,
   0.6393265223310858,
   -1.86032929888045,
   -0.8863580060164147,
   2.342665970545483,
   -0.6532204893911655,
   0.46002366489125784,
   1.1699069608362218,
   0.82491523881539,
   -0.05461322842245171,
   0.4813466168596915,
   0.6554845943989223],
  [-1.9302495531601043,
   -0.9917977482010373,
   0.37426281407554857,
   0.5130138478948342,
   -0.14656267063610706,
   0.35105527491699856,
   -0.03669883605500021,
   0.2106676544562371,
   0.11459187459749902,
   -0.5268191772661094,
   0.27948857096221913,
   -0.07745866443157416,
   -0.4022553950772834,
   -0.05596825217887099,
   -1.13179106697359,
   -0.9341794397868644,
   -0.22763456236442578,
   -0.7042234305857651,
   0.2838189863061714,
   -0.18966143313447395,
   0.7444667963069966,
   -0.5431672122658776,
   -1.237176429242035,
   -2.45045368422049,
   0.9915855718563267,
   -0.3060138491479379,
   -0.9995063797449881,
   1.475125786563477],
  [0.8283929199243483,
   0.47261802657548585,
   -0.2906604808334631,
   0.09806050034148492,
   1.3696295846171975,
   0.28988394088755753,
   0.5134028142450782,
   -0.44697260690491386,
   0.3018257908842648,
   -0.6894190479642907,
   0.4272508209873146,
   -0.6130811438080814,
   1.7024850495475892,
   0.5152053464357677,
   3.072884355498743,
   -0.9256426015708272,
   -0.3025300526975138,
   0.42457256289815887,
   -1.7036940454810896,
   -1.5519241353697313,
   0.2907698368578038,
   -1.4875500777449304,
   -1.6957583499480808,
   1.5653402527313736,
   -0.7105800652682017,
   0.9633286946527746,
   -0.0721147514101468,
   0.7034377327011729],
  [0.1585651674430208,
   -1.9929334583596594,
   0.3153706445759116,
   -0.29427768613145017,
   -1.917078354742576,
   0.15758026312572004,
   0.9662559991064007,
   0.24461200442366252,
   -0.6444204909386758,
   -1.8344797757066031,
   -0.7652380937254631,
   1.2936042567138388,
   0.5738420768951835,
   0.49770142373946535,
   0.1857926470140862,
   -1.5463860481569864,
   -0.5679543663692057,
   -0.0481237881708533,
   -0.6463838240142656,
   0.04322059756165279,
   -0.25363329452088396,
   -2.3676764437531426,
   -1.0190784577601208,
   2.0732679237484892,
   0.43494031723387666,
   0.008650034345195203,
   -0.9067703290528214,
   -0.25160431044691633],
  [0.3615385973250941,
   -0.18072756632614317,
   -1.3391188944735977,
   -0.05222843520354716,
   -0.40626639550681215,
   0.8798462843595631,
   2.0345161811044763,
   0.06703541214300594,
   1.4286458451727557,
   -0.6736079486850648,
   -0.17982741145853512,
   1.313090841555686,
   1.2365032577700932,
   1.01315584681037,
   0.11468040145818602,
   0.5480671527045763,
   -0.23125706943581528,
   -1.039269831175723,
   2.132972521088439,
   -0.35054858404118905,
   1.1283942411127565,
   -1.521480420725669,
   -0.6564695654365619,
   -1.3700798291334528,
   -2.113685661264563,
   -0.2925001503150487,
   -0.7051836195854309,
   -0.5310555912487916],
  [0.3535781279207016,
   -2.28857394279044,
   -0.9776686737619639,
   0.520637298140553,
   -1.8715938060983546,
   -0.010754605888349615,
   -0.2033871776686791,
   -0.3686572262263353,
   -0.02352501873205606,
   2.0699209872519626,
   -0.30831646908961957,
   0.6527798400033578,
   -0.047106781268473716,
   -0.5463614251606113,
   0.3527853674961721,
   1.585963090862678,
   0.46023152687336627,
   -1.003173354893024,
   -1.2503626616003962,
   1.728689218946137,
   -0.473538852253292,
   0.878247665102283,
   -0.3199728227422514,
   0.9237309753565088,
   0.24584720132801646,
   -0.6804871418751288,
   0.2429873710718331,
   1.2216336748884375],
  [0.5518399822523279,
   -0.2470546573570439,
   -0.0057525720053960465,
   -0.8918946703347758,
   -0.9565353438822529,
   0.8147551712265914,
   0.09901149751610717,
   -0.5789862695204401,
   -1.6545687881708504,
   -0.13359940164473505,
   0.0782623725694447,
   0.7516885069651111,
   -0.20719051150345819,
   -1.51846690772642,
   -0.31147028191307086,
   -1.2900680163477525,
   0.06772457496915374,
   1.3423692895802448,
   -0.42054381493821513,
   -0.05287399003348087,
   -0.5299362611898853,
   -0.9242313372745414,
   -0.9273694467232502,
   -0.32133834736425365,
   1.8940219480328095,
   0.15289837192035755,
   -0.06447273206772833,
   0.6912685964866125],
  [-0.2857645367800954,
   2.2779914916629984,
   2.535032263741516,
   -0.12762874917654793,
   0.7764020008860463,
   0.8314917675763563,
   -0.9720745702943989,
   0.0036054363990981426,
   -0.3958079378357114,
   0.55333640782783,
   -0.3640494349998461,
   0.20904007464997995,
   -0.08826020786257999,
   0.1890884616612488,
   -0.2069698318497616,
   1.1103039274075768,
   1.1628984399899316,
   -1.0870621643630896,
   -0.6059389816557846,
   0.1351229275120169,
   -0.9367630333516145,
   -0.38277776537924885,
   -0.23816975573967686,
   -1.238466626153969,
   -1.7940916144717756,
   0.2565279714080546,
   -0.9089356845119111,
   0.7668153526253849],
  [0.42657009456743705,
   -0.5067426988966962,
   1.264278391994163,
   -0.7193365036220812,
   0.09480193325270699,
   0.40119482467579143,
   1.1151380340687502,
   -1.0736021916048324,
   0.006749168686958371,
   -1.7966753533089959,
   0.2295662006130634,
   -1.8462665131031968,
   0.07627254058309095,
   -0.206823467261096,
   -0.8704700625794627,
   -0.548875559322295,
   0.8850374224627663,
   -0.04159457126823043,
   1.2159810057229354,
   0.26247693570067304,
   -0.2211409921031032,
   -0.26045723952170274,
   -1.9513863868259267,
   -0.6149898775439845,
   -0.8901690454178627,
   -1.7731956233677006,
   -0.7687642149243412,
   0.5665235985051372],
  [0.030294316420645125,
   -0.5268993948749677,
   -2.2326428296375807,
   -0.7121741730126927,
   -1.2683436002804718,
   -0.5886179020788682,
   -0.8724344663238288,
   0.4234523867461552,
   -0.7291265677179457,
   -0.06124620609693347,
   0.32443046641826584,
   -0.4719916378458436,
   -1.842523869504668,
   -0.9241707072277802,
   0.516915600741817,
   1.766703950289242,
   -0.12124708275374382,
   -1.6638321108566985,
   0.5506643004826516,
   -0.10327107790409179,
   -0.511623399065034,
   -0.5188462455664308,
   0.9824824405765393,
   0.2960687770822309,
   1.5842392155326988,
   1.0841834220526805,
   1.9652474803798468,
   -0.38405475128759525],
  [-0.9498245598529784,
   -1.9082906347747,
   0.3143708973620254,
   -1.2276965030420475,
   0.48578194678737024,
   -0.3479160740657316,
   -0.804305067156438,
   0.025981508587417674,
   -0.8218986330923659,
   -1.7831419853151413,
   1.3377657956037174,
   -0.8420967966878721,
   0.8125467839558551,
   -1.3284013701959885,
   1.1557376899581433,
   -1.8769942735061966,
   0.13647985892672165,
   0.6205636488848902,
   0.6031919519348585,
   -0.7150150854699567,
   0.4204852033536969,
   -0.8591379800538371,
   0.3711246261494438,
   -1.0630516735033366,
   1.1957057836484672,
   -1.7689188306616377,
   -2.1276654502705017,
   -0.5520238952242532],
  [1.216763929302997,
   -1.4771097521575127,
   -1.313625792965934,
   0.16388007562253562,
   -0.03480950634428498,
   -1.3062737879332842,
   0.27796112788009053,
   1.2648116289003324,
   -0.1755284653781858,
   0.13704194398638628,
   -0.9697609574115902,
   1.1571245570293593,
   1.1218857806981821,
   -0.01977717841615639,
   -2.2209854022399247,
   -1.0682847370481359,
   1.0370019653657359,
   1.2408253031393355,
   -1.0840680593533454,
   0.6759900129605217,
   0.7331513950988771,
   1.361505234160966,
   -0.9686520691815579,
   -0.9347102327346937,
   2.7187854403203184,
   -0.5175518674023059,
   1.022227820347339,
   0.3429506843581937],
  [-0.3750503483041876,
   -0.5682211521359991,
   -1.1648113805770688,
   -2.0230498614456933,
   -1.085904019996265,
   0.709296709720796,
   0.8634485540930567,
   0.056199536142101165,
   0.708698463293038,
   0.19959453396954266,
   0.05175979412091669,
   0.153092949295796,
   -0.8145022916466623,
   1.2045595551044574,
   -0.4809805619338998,
   1.2444810478488997,
   -1.4002525158116301,
   0.21210687473231768,
   -0.13700081735383177,
   0.022833145134222105,
   0.44332623701786716,
   2.3506634513709614,
   0.48064852549936504,
   -0.7664282654398106,
   -0.9826806402330244,
   -1.501410240379249,
   1.4233920135169449,
   0.8124439343272225],
  [-1.0177267847655755,
   1.0032969427798653,
   -2.4119707632973264,
   -1.7405302575507173,
   1.1363457151220357,
   -1.0894670189867433,
   -0.2770957164123188,
   -0.35738706673088366,
   -0.8200359111859917,
   0.6413192197350888,
   1.011824788842574,
   -0.06032955884837017,
   0.9354184450653202,
   1.2536765615793724,
   -0.650808104216898,
   0.32782087637229035,
   0.13952572019583004,
   0.9644344941695036,
   -1.5254542088660432,
   -0.039079688577887246,
   -0.2516907149779169,
   0.539120117441259,
   -0.6055570962399353,
   1.1699232153680272,
   0.6285585927179105,
   -0.0701752184941755,
   1.9237504151417633,
   1.741524726465833]];
    this.clickedGetExplanation.next({
      model: {
        name: 'mnist',
        version: '16',
      },
      explained_instance: explainedInstance,
    });
  }
}
